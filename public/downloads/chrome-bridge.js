#!/usr/bin/env node
"use strict";var v=Object.create;var $=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var x=(o,r,n,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of b(r))!A.call(o,s)&&s!==n&&$(o,s,{get:()=>r[s],enumerable:!(e=T(r,s))||e.enumerable});return o};var h=(o,r,n)=>(n=o!=null?v(y(o)):{},x(r||!o||!o.__esModule?$(n,"default",{value:o,enumerable:!0}):n,o));var C=h(require("net"),1),P=require("child_process"),I=require("util"),S=h(require("os"),1),g=h(require("fs"),1),p=(0,I.promisify)(P.exec),m=19222,w=new Set,t=S.default.platform(),u=process.env.USER||process.env.USERNAME||S.default.userInfo().username;function M(){return t==="win32"?`\\\\.\\pipe\\claude-mcp-browser-bridge-${u}`:t==="darwin"?`${process.env.TMPDIR||"/tmp/"}claude-mcp-browser-bridge-${u}`:`/tmp/claude-mcp-browser-bridge-${u}`}var d=M();async function O(){if(process.env.TAILSCALE_IP)return console.log(`Using Tailscale IP from environment: ${process.env.TAILSCALE_IP}`),process.env.TAILSCALE_IP;let o=["tailscale","/usr/bin/tailscale","/usr/local/bin/tailscale","/Applications/Tailscale.app/Contents/MacOS/Tailscale"];for(let r of o)try{let{stdout:n}=await p(`"${r}" ip -4`);return n.trim()}catch{continue}console.error("Failed to get Tailscale IP. Is Tailscale running?"),console.error(`
Troubleshooting:`),console.error("1. Check Tailscale is running:"),console.error(t==="darwin"?"   /Applications/Tailscale.app/Contents/MacOS/Tailscale status":"   tailscale status"),console.error("2. Verify you have a Tailscale IP:"),console.error(t==="darwin"?"   /Applications/Tailscale.app/Contents/MacOS/Tailscale ip -4":"   tailscale ip -4"),console.error(`
3. Or manually specify your Tailscale IP:`),console.error("   Set TAILSCALE_IP environment variable:"),console.error("   TAILSCALE_IP=100.x.x.x node chrome-bridge.js"),process.exit(1)}function E(){if(t==="win32")console.log(`\u23F3 Will attempt to connect to: ${d}`),console.warn("If connection fails, make sure Claude Code is running with --chrome flag.");else if(g.default.existsSync(d)){let o=g.default.statSync(d);console.log(`\u2713 MCP bridge socket found: ${d}`),console.log(`  Last modified: ${o.mtime.toLocaleString()}`);try{let r=process.env.TMPDIR||"/tmp/",e=g.default.readdirSync(r).filter(s=>s.startsWith("claude-mcp-browser-bridge-"));e.length>1&&console.log(`
\u2139\uFE0F  Note: Found ${e.length} MCP bridge sockets (using ${u}'s socket)`)}catch{}}else{console.warn(`
\u26A0\uFE0F  Warning: MCP bridge socket not found: ${d}`),console.warn("Make sure Claude Code is running with --chrome flag."),console.warn(`Example: claude --chrome
`);try{let o=process.env.TMPDIR||"/tmp/",n=g.default.readdirSync(o).filter(e=>e.startsWith("claude-mcp-browser-bridge-"));n.length>0&&(console.warn(`Found other MCP bridge sockets in ${o}:`),n.forEach(e=>{let s=`${o}${e}`,i=g.default.statSync(s);console.warn(`  - ${e} (modified: ${i.mtime.toLocaleString()})`)}),console.warn(`
Note: Using the socket for current user ($USER)
`))}catch{}}}async function L(){let o=await O(),r={darwin:"MacOS",linux:"Linux",win32:"Windows"}[t]||t;console.log("=".repeat(60)),console.log("Claude Code Chrome MCP Bridge Server"),console.log("=".repeat(60)),console.log(`Platform: ${r}`),console.log(`User: ${u}`),console.log(`Tailscale IP: ${o}`),console.log(`TCP Port: ${m}`),console.log(`Socket: ${d}`),console.log("=".repeat(60)),E();let n=C.default.createServer(e=>{let s=`${e.remoteAddress}:${e.remotePort}`;console.log(`[${new Date().toISOString()}] Client connected: ${s}`),w.add(e);let i=C.default.connect(d);i.on("connect",()=>{console.log(`[${new Date().toISOString()}] Connected to MCP bridge socket`)}),e.on("data",async c=>{if(c.toString().includes('"type":"version"')){console.log(`[${new Date().toISOString()}] Version query received`);try{let l="";if(t==="darwin"){let{stdout:a}=await p("/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome --version");l=a.trim()}else if(t==="linux")try{let{stdout:a}=await p("google-chrome --version");l=a.trim()}catch{let{stdout:a}=await p("chromium-browser --version");l=a.trim()}else if(t==="win32"){let{stdout:a}=await p('"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe" --version');l=a.trim()}console.log(`[${new Date().toISOString()}] Chrome version: ${l}`),e.write(l)}catch(l){console.error(`[${new Date().toISOString()}] Failed to get Chrome version:`,l.message),e.write("Error: Could not get Chrome version")}return}i.write(c)}),i.on("data",c=>{e.write(c)});let f=()=>{w.delete(e),e.destroy(),i.destroy(),console.log(`[${new Date().toISOString()}] Client disconnected: ${s}`)};e.on("error",c=>{console.error(`[${new Date().toISOString()}] Client socket error:`,c.message),f()}),i.on("error",c=>{console.error(`[${new Date().toISOString()}] Unix socket error:`,c.message),c.code==="ENOENT"&&console.error(`
\u26A0\uFE0F  MCP bridge socket not found. Is Claude Code running with --chrome?`),f()}),e.on("end",()=>{f()}),i.on("end",()=>{f()})});n.listen(m,"0.0.0.0",()=>{console.log(`
\u2713 Bridge server listening on 0.0.0.0:${m}`),console.log(`
Remote containers can now connect via: ${o}:${m}`),console.log(`
Press Ctrl+C to stop the bridge server.
`)}),n.on("error",e=>{e.code==="EADDRINUSE"?(console.error(`
\u274C Port ${m} is already in use.`),console.error(`Another bridge server may already be running.
`),process.exit(1)):(console.error("Server error:",e),process.exit(1))}),process.on("SIGINT",()=>{console.log(`

Shutting down bridge server...`);for(let e of w)e.destroy();w.clear(),n.close(()=>{console.log("Bridge server stopped."),process.exit(0)})})}L().catch(o=>{console.error("Failed to start bridge server:",o),process.exit(1)});
//# sourceMappingURL=chrome-bridge-bundled.js.map
